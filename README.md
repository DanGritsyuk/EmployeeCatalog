# Employee Catalog Console Application

## Основные специфики

Консольное приложение разработано с использованием **чистой архитектуры (Clean Architecture)**, что обеспечивает разделение ответственности между слоями приложения и упрощает поддержку и расширение функциональности. Стек технологий:
- **C#**, **.NET 8**
- База данных: **MongoDB**

---

## Что было задумано, но не успел реализовать

### 1. Логгер
Временной заменой логгера является вывод сообщений в консоль с помощью `Console.WriteLine()`.

### 2. Интеграция с PostgreSQL
В проекте планировалась возможность записи событий в **PostgreSQL** с использованием **Entity Framework**. Транзакции в MongoDB были реализованы с учетом будущей синхронизации данных между MongoDB и PostgreSQL. Это позволит обеспечить целостность данных в обеих базах данных при выполнении операций записи. Например, при добавлении сотрудника в MongoDB, соответствующее событие будет записано в PostgreSQL, что обеспечит надежное хранение истории изменений.

### 3. Репликационный набор MongoDB
Для использования транзакций в MongoDB необходимо настроить **репликационный набор (replica set)**, так как транзакции поддерживаются только в кластерах с репликацией. Это обеспечивает отказоустойчивость и целостность данных.

---

## Отчет о выполнении

### 1. Создание таблицы
- **Команда**: `.\ConsoleApp.exe --mode 1`
- **Описание**:  
  В режиме 1 создается таблица (коллекция) "Employees" в базе данных MongoDB. Если таблица уже существует, выводится соответствующее сообщение. Также в этом режиме создается составной индекс на поля `Gender` и `FullName`.

### 2. Добавление сотрудника
- **Команда**: `.\ConsoleApp.exe --mode 2 --fullName "Ivanov Petr Sergeevich" --birthDate 2009-07-12 --gender Male`
- **Описание**:  
  В режиме 2 добавляется новый сотрудник в базу данных. Данные о сотруднике передаются через аргументы командной строки: ФИО, дата рождения и пол. Используется асинхронная запись данных в базу, что позволяет избежать блокировки основного потока приложения.

### 3. Получение всего списка сотрудников
- **Команда**: `.\ConsoleApp.exe --mode 3`
- **Описание**:  
  В режиме 3 выполняется вывод всех сотрудников из базы данных. Данные возвращаются в виде стрима, что позволяет обрабатывать их по мере поступления, не загружая все записи в память одновременно.

### 4. Добавление миллиона записей
- **Команда**: `.\ConsoleApp.exe --mode 4 --count 1000000`
- **Описание**:  
  В режиме 4 выполняется массовое добавление сотрудников в базу данных. Генерация данных происходит асинхронно, а записи добавляются пакетами по 100 штук за раз. Используется семафор для ограничения количества одновременных подключений к базе данных, что позволяет избежать перегрузки сервера.

### 5. Получение списка по фильтру
- **Команда**: `.\ConsoleApp.exe --mode 5 --letter F --gender Male`
- **Описание**:  
  В режиме 5 выполняется выборка сотрудников по критерию: пол мужской и фамилия начинается с буквы "F". Результаты выводятся с указанием времени выполнения запроса.

---

## Оптимизация базы данных и запросов

Произведена оптимизация базы данных и запросов для ускорения выполнения пункта 5.

### Исходные данные:
- Количество найденных записей: **166500**.
- Время выполнения до оптимизации: **2692 мс**.
- Время выполнения после оптимизации: **1387 мс**.

### Выполненные изменения:
1. **Составной индекс**:
   - В методе создания таблицы переписан составной индекс на поля `Gender` и `FullName`. Это позволило MongoDB эффективно фильтровать данные по обоим полям одновременно.

2. **Проекции**:
   - Изменен запрос с фильтрацией. Вместо того чтобы возвращать все поля документа, запрос теперь возвращает только `FullName` и `BirthDate`. Это уменьшило объем данных, передаваемых по сети, и снизило нагрузку на сервер.

---

## Заключение

Приложение успешно реализует основные функции работы с базой данных сотрудников. Оптимизация запросов и индексов позволила значительно улучшить производительность. В будущем планируется добавить логгер, интеграцию с PostgreSQL и настроить репликационный набор MongoDB для поддержки транзакций в production-среде.
